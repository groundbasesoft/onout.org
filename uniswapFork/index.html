<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Uniswap Fork</title>
    <meta name="description" content="Step-by-step guide how to fork Uniswap" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
	  <link rel="canonical" href="https://onout.org/uniswapFork/" />
    <style>:root{--background-body:#fff;--background:#efefef;--background-alt:#f7f7f7;--selection:#9e9e9e;--text-main:#363636;--text-bright:#000;--text-muted:#70777f;--links:#0076d1;--focus:rgba(0,150,191,0.67);--border:#dbdbdb;--code:#000;--animation-duration:0.1s;--button-base:#d0cfcf;--button-hover:#9b9b9b;--scrollbar-thumb:#aaa;--scrollbar-thumb-hover:var(--button-hover);--form-placeholder:#949494;--form-text:#1d1d1d;--variable:#39a33c;--highlight:#ff0;--select-arrow:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' height='63' width='117' fill='%23161f27'%3E%3Cpath d='M115 2c-1-2-4-2-5 0L59 53 7 2a4 4 0 00-5 5l54 54 2 2 3-2 54-54c2-1 2-4 0-5z'/%3E%3C/svg%3E")}html{scrollbar-color:#aaa #fff;scrollbar-color:var(--scrollbar-thumb) var(--background-body);scrollbar-width:thin}body{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,Segoe UI Emoji,Apple Color Emoji,Noto Color Emoji,sans-serif;line-height:1.4;max-width:800px;margin:20px auto;padding:0 10px;word-wrap:break-word;color:#363636;color:var(--text-main);background:#fff;background:var(--background-body);text-rendering:optimizeLegibility}button,input,textarea{transition:background-color .1s linear,border-color .1s linear,color .1s linear,box-shadow .1s linear,transform .1s ease;transition:background-color var(--animation-duration) linear,border-color var(--animation-duration) linear,color var(--animation-duration) linear,box-shadow var(--animation-duration) linear,transform var(--animation-duration) ease}h1{font-size:2.2em;margin-top:0}h1,h2,h3,h4,h5,h6{margin-bottom:12px;margin-top:24px}h1,h2,h3,h4,h5,h6,strong{color:#000;color:var(--text-bright)}b,h1,h2,h3,h4,h5,h6,strong,th{font-weight:600}q:after,q:before{content:none}blockquote,q{border-left:4px solid rgba(0,150,191,.67);border-left:4px solid var(--focus);margin:1.5em 0;padding:.5em 1em;font-style:italic}blockquote>footer{font-style:normal;border:0}address,blockquote cite{font-style:normal}a[href^=mailto\:]:before{content:"ðŸ“§ "}a[href^=tel\:]:before{content:"ðŸ“ž "}a[href^=sms\:]:before{content:"ðŸ’¬ "}mark{background-color:#ff0;background-color:var(--highlight);border-radius:2px;padding:0 2px;color:#000}a>code,a>strong{color:inherit}button,input[type=button],input[type=checkbox],input[type=radio],input[type=range],input[type=reset],input[type=submit],select{cursor:pointer}input,select{display:block}[type=checkbox],[type=radio]{display:initial}button,input,select,textarea{color:#1d1d1d;color:var(--form-text);background-color:#efefef;background-color:var(--background);font-family:inherit;font-size:inherit;margin-right:6px;margin-bottom:6px;padding:10px;border:none;border-radius:6px;outline:none}button,input[type=button],input[type=reset],input[type=submit]{background-color:#d0cfcf;background-color:var(--button-base);padding-right:30px;padding-left:30px}button:hover,input[type=button]:hover,input[type=reset]:hover,input[type=submit]:hover{background:#9b9b9b;background:var(--button-hover)}input[type=color]{min-height:2rem;padding:8px;cursor:pointer}input[type=checkbox],input[type=radio]{height:1em;width:1em}input[type=radio]{border-radius:100%}input{vertical-align:top}label{vertical-align:middle;margin-bottom:4px;display:inline-block}button,input:not([type=checkbox]):not([type=radio]),input[type=range],select,textarea{-webkit-appearance:none}textarea{display:block;margin-right:0;box-sizing:border-box;resize:vertical}textarea:not([cols]){width:100%}textarea:not([rows]){min-height:40px;height:140px}select{background:#efefef url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' height='63' width='117' fill='%23161f27'%3E%3Cpath d='M115 2c-1-2-4-2-5 0L59 53 7 2a4 4 0 00-5 5l54 54 2 2 3-2 54-54c2-1 2-4 0-5z'/%3E%3C/svg%3E") calc(100% - 12px) 50%/12px no-repeat;background:var(--background) var(--select-arrow) calc(100% - 12px) 50%/12px no-repeat;padding-right:35px}select::-ms-expand{display:none}select[multiple]{padding-right:10px;background-image:none;overflow-y:auto}button:focus,input:focus,select:focus,textarea:focus{box-shadow:0 0 0 2px rgba(0,150,191,.67);box-shadow:0 0 0 2px var(--focus)}button:active,input[type=button]:active,input[type=checkbox]:active,input[type=radio]:active,input[type=range]:active,input[type=reset]:active,input[type=submit]:active{transform:translateY(2px)}button:disabled,input:disabled,select:disabled,textarea:disabled{cursor:not-allowed;opacity:.5}::-moz-placeholder{color:#949494;color:var(--form-placeholder)}:-ms-input-placeholder{color:#949494;color:var(--form-placeholder)}::-ms-input-placeholder{color:#949494;color:var(--form-placeholder)}::placeholder{color:#949494;color:var(--form-placeholder)}fieldset{border:1px solid rgba(0,150,191,.67);border:1px solid var(--focus);border-radius:6px;margin:0 0 12px;padding:10px}legend{font-size:.9em;font-weight:600}input[type=range]{margin:10px 0;padding:10px 0;background:transparent}input[type=range]:focus{outline:none}input[type=range]::-webkit-slider-runnable-track{width:100%;height:9.5px;-webkit-transition:.2s;transition:.2s;background:#efefef;background:var(--background);border-radius:3px}input[type=range]::-webkit-slider-thumb{box-shadow:0 1px 1px #000,0 0 1px #0d0d0d;height:20px;width:20px;border-radius:50%;background:#dbdbdb;background:var(--border);-webkit-appearance:none;margin-top:-7px}input[type=range]:focus::-webkit-slider-runnable-track{background:#efefef;background:var(--background)}input[type=range]::-moz-range-track{width:100%;height:9.5px;-moz-transition:.2s;transition:.2s;background:#efefef;background:var(--background);border-radius:3px}input[type=range]::-moz-range-thumb{box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d;height:20px;width:20px;border-radius:50%;background:#dbdbdb;background:var(--border)}input[type=range]::-ms-track{width:100%;height:9.5px;background:transparent;border-color:transparent;border-width:16px 0;color:transparent}input[type=range]::-ms-fill-lower,input[type=range]::-ms-fill-upper{background:#efefef;background:var(--background);border:.2px solid #010101;border-radius:3px;box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d}input[type=range]::-ms-thumb{box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d;border:1px solid #000;height:20px;width:20px;border-radius:50%;background:#dbdbdb;background:var(--border)}input[type=range]:focus::-ms-fill-lower,input[type=range]:focus::-ms-fill-upper{background:#efefef;background:var(--background)}a{text-decoration:none;color:#0076d1;color:var(--links)}a:hover{text-decoration:underline}code,samp,time{background:#efefef;background:var(--background);color:#000;color:var(--code);padding:2.5px 5px;border-radius:6px;font-size:1em}pre>code{padding:10px;display:block;overflow-x:auto}var{color:#39a33c;color:var(--variable);font-style:normal;font-family:monospace}kbd{background:#efefef;background:var(--background);border:1px solid #dbdbdb;border:1px solid var(--border);border-radius:2px;color:#363636;color:var(--text-main);padding:2px 4px}img,video{max-width:100%;height:auto}hr{border:none;border-top:1px solid #dbdbdb;border-top:1px solid var(--border)}table{border-collapse:collapse;margin-bottom:10px;width:100%;table-layout:fixed}table caption,td,th{text-align:left}td,th{padding:6px;vertical-align:top;word-wrap:break-word}thead{border-bottom:1px solid #dbdbdb;border-bottom:1px solid var(--border)}tfoot{border-top:1px solid #dbdbdb;border-top:1px solid var(--border)}tbody tr:nth-child(2n){background-color:#efefef;background-color:var(--background)}tbody tr:nth-child(2n) button{background-color:#f7f7f7;background-color:var(--background-alt)}tbody tr:nth-child(2n) button:hover{background-color:#fff;background-color:var(--background-body)}::-webkit-scrollbar{height:10px;width:10px}::-webkit-scrollbar-track{background:#efefef;background:var(--background);border-radius:6px}::-webkit-scrollbar-thumb{background:#aaa;background:var(--scrollbar-thumb);border-radius:6px}::-webkit-scrollbar-thumb:hover{background:#9b9b9b;background:var(--scrollbar-thumb-hover)}::-moz-selection{background-color:#9e9e9e;background-color:var(--selection);color:#000;color:var(--text-bright)}::selection{background-color:#9e9e9e;background-color:var(--selection);color:#000;color:var(--text-bright)}details{display:flex;flex-direction:column;align-items:flex-start;background-color:#f7f7f7;background-color:var(--background-alt);padding:10px 10px 0;margin:1em 0;border-radius:6px;overflow:hidden}details[open]{padding:10px}details>:last-child{margin-bottom:0}details[open] summary{margin-bottom:10px}summary{display:list-item;background-color:#efefef;background-color:var(--background);padding:10px;margin:-10px -10px 0;cursor:pointer;outline:none}summary:focus,summary:hover{text-decoration:underline}details>:not(summary){margin-top:0}summary::-webkit-details-marker{color:#363636;color:var(--text-main)}dialog{background-color:#f7f7f7;background-color:var(--background-alt);color:#363636;color:var(--text-main);border-radius:6px;border:#dbdbdb;border-color:var(--border);padding:10px 30px}dialog>header:first-child{background-color:#efefef;background-color:var(--background);border-radius:6px 6px 0 0;margin:-10px -30px 10px;padding:10px;text-align:center}dialog::-webkit-backdrop{background:rgba(0,0,0,.61);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}dialog::backdrop{background:rgba(0,0,0,.61);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}footer{border-top:1px solid #dbdbdb;border-top:1px solid var(--border);padding-top:10px;color:#70777f;color:var(--text-muted)}body>footer{margin-top:40px}@media print{body,button,code,details,input,pre,summary,textarea{background-color:#fff}button,input,textarea{border:1px solid #000}body,button,code,footer,h1,h2,h3,h4,h5,h6,input,pre,strong,summary,textarea{color:#000}summary::marker{color:#000}summary::-webkit-details-marker{color:#000}tbody tr:nth-child(2n){background-color:#f2f2f2}a{color:#00f;text-decoration:underline}}</style>
    <style>img {
      display: block;
      height: auto;
      max-width: 100%;
      margin: 1.3rem 0 2.5rem;
      border-radius: 0.5rem;
      border: 1px solid #bebebe;
    }
    
    .group {
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #cccccc;
    }
    
    footer {
      padding: 1rem 0;
    }
    </style>
    <script>
    if (location.protocol !== 'https:') {
      location.replace(`https:${location.href.substring(location.protocol.length)}`);
    }
    </script>
    <style>
      .banner {
        font-size: 1.2em;
        padding: 0.7rem;
        font-weight: 500;
        border-radius: 0.5rem;
        border: 2px solid rgb(0, 0, 0, 0.09);
        box-shadow: 0 0 0.7rem rgb(0, 0, 0, 0.03);
        background-color: rgb(0, 0, 0, 0.03);
        color: #000;
      }
    </style>
  </head>

  <body>
    <header>
      <h1>Uniswap V2 fork</h1>
      <p>How to create uniswap fork and collect 0.05% fees for every trade.</p>
      <p class="banner">
        See also: Do not want to waste your time and make mistakes?
        <br>
        Use extended version without coding skills: <a href="https://github.com/appsource/dex" target="_blank">no-code tool for creating DEX</a>
      </p>
    </header>
    <main>
      <section>
        <h2>Introduction</h2>

        <ul>
          <li>
            <a href="https://github.com/Uniswap/v2-core">Uniswap V2-core</a>
          </li>
          <li>
            <a href="https://github.com/Uniswap/v2-periphery">Uniswap V2-periphery</a>
          </li>
          <li>
            <a href="https://github.com/Uniswap/v2-sdk">Uniswap V2-sdk</a>
          </li>
          <li>
            <a href="https://www.trufflesuite.com/docs/truffle/overview">Truffle</a>
          </li>
          <li>
            <a href="https://www.trufflesuite.com/docs/ganache/overview">Ganache</a>
          </li>
          <li>
            <a href="https://github.com/rkalis/truffle-plugin-verify">Verify plugin for Truffle</a>
          </li>
          <li>
            <a href="https://uniswap.org/whitepaper.pdf">Uniswap V2 Core whitepaper</a>
          </li>
          <li>
            <a href="https://uniswap.org/docs/v2/">Uniswap V2 docs</a>
          </li>
          <li>
            <a href="https://etherscan.io/address/0x5c69bee701ef814a2b6a3edd4b1652cb9cc5aa6f#code">Uniswap V2 factory contract</a>
          </li>
          <li>
            <a href="https://etherscan.io/address/0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D#code">Uniswap V2 router code</a>
          </li>
          <li>
            <a href="https://remix.ethereum.org/">Remix</a>
          </li>
          <li>
            <a id="start-template-source" href="https://github.com/1azy-guy/CoolSwap-interface">Interface template</a>
            (Uniswap team didn't make a new repo for V3 interface, but we need a version which is as close as possible to Uniswap V2
            for ease of interaction with V2 contracts. So we can use it as a start template)
          </li>
          <li>
            <a href="https://github.com/1azy-guy/CoolSwap-core">Core template</a>
          </li>
          <li>
            <a href="https://github.com/1azy-guy/CoolSwap-periphery">Periphery template</a>
          </li>
        </ul>

        <blockquote>
          <p>
            We will use Rinkeby test network. Deploy through Truffle and use these contracts, exept a section
            with Remix deployment, where will be a Ropsten network.
          </p>
          <p><b>tx</b> - short name for transaction</p>
        </blockquote>
      </section>

      <section>
        <h2>Table of contents</h2>

        <ul>
          <li>
            <a href="#deploy-with-truffle">Deploy with Truffle</a>
            
            <ul>
              <li>
                <a href="#core-contracts">Core contracts</a>
                
                <ul>
                  <li><a href="#base-core-contracts-template">base core contracts template</a></li>
                  <li><a href="#deploy-core-with-ganache">deploy core with Ganache</a></li>
                  <li><a href="#deploy-core-on-testnet">deploy core on the testnet</a></li>
                </ul>
              </li>

              <li>
                <a href="#periphery-contracts">Periphery contracts</a>
                <ul>
                  <li><a href="#base-periphery-template">base periphery template</a></li>
                  <li><a href="#deploy-periphery-on-testnet">deploy periphery on the testnet</a></li>
                </ul>
              </li>
            </ul>
          </li>

          <li>
            <a href="#contracts-title">Deploy with Remix</a>
            <ul>
              <li><a href="#remix-editor-start">start with Remix</a></li>
              <li><a href="#copy-uniswap-factory">uniswap factory</a></li>
              <li>
                <a href="#replace-factory-names">replace factory names</a>
              </li>
              <li><a href="#add-pair-code-hash">add INIT_CODE_HASH</a></li>
              <li><a href="#compile-factory">compile CoolSwapFactory</a></li>
              <li><a href="#deploy-factory">deploy CoolSwapFactory</a></li>
              <li>
                <a href="#save-factory-address">save the factory address</a>
              </li>
              <li>
                <a href="#set-protocol-fee-address"
                  >set a protocol fee address</a
                >
              </li>
              <li><a href="#save-init-code-hash">save INIT_CODE_HASH</a></li>
              <li>
                <a href="#create-router-file">create a router contract</a>
              </li>
              <li>
                <a href="#replace-init-code-hash">replace INIT_CODE_HASH</a>
              </li>
              <li>
                <a href="#deploy-router-contract">deploy CoolSwapRouter</a>
              </li>
              <li><a href="#final-contract-data">final contract data</a></li>
            </ul>
          </li>

          <li>
            <a href="#frontend">Frontend</a>
            <ul>
              <li>
                <a href="#interface-start-template">start template</a>
              </li>
              <li><a href="#what-need-to-change">what's need to change</a></li>
              <li><a href="#interface-start">start work in the interface interface</a></li>
              <li><a href="#check-protocol-fee">check protocol fee</a></li>
            </ul>
          </li>
          <li>
            <a href="#additional-changes-title">Additional changes</a>
          </li>
        </ul>
      </section>

      <section>
        <h2 id="deploy-with-truffle">Deploy with Truffle</h2>

        <h3 id="core-contracts">Core contracts</h3>

        <blockquote>
          <p>
            When replacing the code, you need to pay attention to the places
            where the prefix <b>0x</b> is found, you have to save it and replace
            what follows it
          </p>
        </blockquote>

        <ol>
          <li id="base-core-contracts-template">
            Create a new folder CoolSwap-core and copy there the code from Gihub repo. 
            Create two files: <code>.env</code> (deployment data) and <code>.secret</code> (leave here your mnemonic phrase).

            <blockquote class="danger">
              <p>
                Don't lose your private info like mnemonic phrase or API key.
                All this info in our case will be in <b>dot</b> files that are added to <code>.gitignore</code>
                file to exclude it from git tracking
              </p>
            </blockquote>

            Add these variables in the `.env`:
            <pre><code>TESTNET_NETWORK_URL="https://rinkeby.infura.io/v3/3cb031735f9a46a69f2babab4fae3e0d"</code></pre>
            <pre><code>TESTNET_NETWORK_ID="4"</code></pre>
            <pre><code>EXPLORER_API_KEY="fill it with your key from the explorer account"</code></pre>

            And add your mnemonic phrase in the <code>.secret</code> file (just paste words).
            For mainnet values replace names prefixes with <code>MAINNET_</code> and of course add your own links
          </li>

          <li>
            You can copy a core contracts template or make the same actions as described next.
            In the <code>SwapFactory.sol</code> contract was added a new line. After factory deployment we need to copy this parameter from the blockchain and paste it in Library:

            <pre><code>bytes32 public constant INIT_CODE_PAIR_HASH = keccak256(abi.encodePacked(type(SwapPair).creationCode));</code></pre>

            In the <code>SwapERC20.sol</code> contract we change Uniswap token names with ours:
            
            <pre><code>string public constant name = 'Swap-LP-Token';</code></pre>
            <pre><code>string public constant symbol = 'SWAP-LP';</code></pre>

            And were changed all log/file names with <b>Swap</b> name in <code>SwapFactory.sol</code>,
            <code>SwapERC20.sol</code> and <code>SwapPair.sol</code>
          </li>

          <li id="deploy-core-with-ganache">
            At first we download <b>Ganache</b> where you can fast and easy make the first tests locally.
            After we've checked that on your machine everything is fine we can more slower deploy on testnet.

            <blockquote>
              <p>
                Work with Nodejs 16.\* version
              </p>
            </blockquote>

            Install dependencies:

            <pre><code>npm i</code></pre>

            Download Ganache and start it (quick start is enough).
            Correct <code>development</code> settings in the <code>truffle-config.js</code> if they doesn't
            match with Ganache settings. But probable it's fine by default.
          </li>

          <li>
            Go to <code>2_deploy_contracts.js</code> and fill these variables
            (<b>adminAddress</b> address will be able to change himself (_feeToSetter) and 
            feeCollectingAddress (_feeTo) in the deployed factory):

            <pre><code>const adminAddress = "";</code></pre>
            <pre><code>const feeCollectingAddress = "";</code></pre>
          </li>

          <li>
            Compile contracts (confirm truffle installation if it wasn't installed):

            <pre><code>npx truffle compile</code></pre>

            <img src="./img/truffle-core/truffle-compile-contracts.png" alt="" />

            Deploy contracts on Ganache local blockchain:

            <pre><code>npx truffle migrate --reset --network development</code></pre>
            
            No you probably can see this error in the terminal/console:

            <pre><code>Error: Returned error: VM Exception while processing transaction: revert Swap: FORBIDDEN -- Reason given: Swap: FORBIDDEN.</code></pre>

            We set <code>adminAddress</code> not from local Ganache blockchain.
            So we can't use <code>setFeeTo</code> method, because we call this method we use Ganache
            blockchain address instead of <code>adminAddress</code> (if you didn't set this address from Ganache).
            If you want to bypass this error just change <code>adminAddress</code> with the first one
            from Ganache or comment this string:

            <img src="./img/truffle-core/solve-local-ganache-problem.png" alt="" />

            In the successful option you have to see something like this:

            <img src="./img/truffle-core/successful-ganache-core-deploy.png" alt="" />
          </li>

          <li id="deploy-core-on-testnet">
            Well for now it seems ok. It's more faster to debug/solve problems. Now we deploy it on testnet.
            Contracts are already compiled and we can just change a deploy command:

            <pre><code>npx truffle migrate --reset --network testnet</code></pre>

            You have to see similar output as with Ganache deployment, but you're able to check it on Ethereum testnet.
            Copy a factory address (from the explorer or truffle output) and save it. Let's verify the factory:

            <pre><code>npx truffle run verify SwapFactory --network testnet</code></pre>

            Now the contract is verified

            <img src="./img/truffle-core/check-factory-on-testnet.png" alt="" />

            Go to a <b>Read Contract</b> tab, copy <code>INIT_CODE_PAIR_HASH</code> parameter and save it
          </li>
        </ol>

        <blockquote>
          <p>Finally we have this parameters:</p>
          <br>

          Factory: <pre><code>0x6Bd5A1A63ffF10De3c6B7C667040E9AE1B47fDf2</code></pre>
          INIT_CODE_PAIR_HASH: <pre><code>0xaf88dd15a55596feb9d67243c727bfd6144af12453963809bc91f0cfcf8241bc</code></pre>
        </blockquote>

        <h3 id="periphery-contracts">Periphery contracts</h3>

        <ol>
          <li id="base-periphery-template">
            This template has changed names/logs in <code>SwapLibrary.sol</code>, <code>SwapRouterV1</code>
            and <code>SwapRouterV2</code>. And for now we have to change only <b>init code hash</b> value
            in a library:

            <img src="./img/truffle-periphery/change-init-code-hash-in-library.png" alt="" />
          </li>

          <li>
            Copy <code>.env</code> and <code>.secret</code> files from the <b>CoolSwap-core</b> folder
            and install dependecies: 

            <pre><code>npm i</code></pre>
          </li>

          <li>
            Go to <code>2_deploy_contracts.js</code> and fill these variables:

            <pre><code>const factoryAddress = "";</code></pre>
            <pre><code>const WETH = "";</code></pre>

            For the testnet we can use this WETH contract: <code>0xc778417e063141139fce010982780140aa0cd5ab</code>

            <blockquote class="danger">
              <p>
                Use only trusted sources for main networks, like <a href="https://www.coingecko.com/">CoinGecko</a>
              </p>
            </blockquote>

            Compile contracts:

            <pre><code>npx truffle compile</code></pre>
          </li>

          <li id="deploy-periphery-on-testnet">
            Let's do the same actions with Ganache as for core to be sure there're no errors.
            After this we deploy contracts on the testnet:

            <pre><code>npx truffle migrate --reset --network testnet</code></pre>

            And also verify the router contract:

            <pre><code>npx truffle run verify SwapRouterV2 --network testnet</code></pre>

            <img src="./img/truffle-periphery/verify-router-contract.png" alt="" />
          </li>

          <blockquote>
            <p>Here we need only a router address</p>

            <pre><code>0xA4E1f3fD10E2397f58926E215Ed331D7cDA14056</code></pre>
          </blockquote>
        </ol>
      </section>

      <section>
        <h2 id="contracts-title">Deploy with Remix</h2>

        <ol>
          <li id="remix-editor-start">
            Go to
            <a target="_blank" href="https://remix.ethereum.org"
              >Remix editor</a
            >
            and create there two files: <b>CoolSwapFactory.sol</b>,
            <b>CoolSwapRouter.sol</b>
          </li>

          <li id="copy-uniswap-factory">
            Let's begin with factory. Copy Uniswap factory code from the
            Etherscan:

            <img src="./img/contracts/copyFactory.png" alt="copy uniswap factory code" />

            And paste it into the new CoolSwapFactory file:
            <img
              src="./img/contracts/copyUniswapFactoryCode.png"
              alt="paste the factory code in the new file"
            />
          </li>

          <li id="replace-factory-names">
            Replace ERC20 contract name with <b>CoolSwapERC20</b>. Also replace
            two constants: <b>name</b> with <b>CoolSwap LP</b>,
            <b>symbol</b> with <b>Cool-LP</b>. It will be a bonus token which
            the user will receive for his liquidity:

            <img
              src="./img/contracts/replaceErc20ContractNames.png"
              alt="replace names for erc20 token in the new factory file"
            />
          </li>

          <li>
            Replace a pair contract name with <b>CoolSwapPair</b>. Also replace
            next to it ERC20 contract name:
            <img
              src="./img/contracts/replacePairContractName.png" alt="" />

            Also change it in the <b>createPair</b> method:
            <img
              src="./img/contracts/replacePairNameInTheCreateMethod.png"
              alt="replace other names for erc20 and pair contracts"
            />

            And finally just a little above change the factory name:
            <img
              src="./img/contracts/changeFactoryContractName.png"
              alt="replace the factory contract name"
            />

            <blockquote>
              You're able to replace all names (interfaces, logs and so on), but
              we won't do this
            </blockquote>
          </li>

          <li id="add-pair-code-hash">
            Add the following line in the CoolSwapFactory contract:

            <pre><code>bytes32 public constant INIT_CODE_HASH = keccak256(abi.encodePacked(type(CoolSwapPair).creationCode));</code></pre>
            <img
              src="./img/contracts/addInitCodeHashInFactory.png"
              alt="add an init code hash in the factory"
            />
          </li>

          <li id="compile-factory">
            Go to <b>"Solidity Compiler"</b> tab. Change compiler version with
            <em>0.5.16</em> if it's different. Enable optimization option and
            click button <b>"Compile"</b>:

            <img
              src="./img/contracts/compileFactoryButton.png"
              alt="compile factory button"
            />
          </li>

          <li id="deploy-factory">
            Go to
            <b>"Deploy & run transaction"</b> tab. Select
            <b>Injected Web3</b> in the ENVIRONMENT drop-down. It will use your
            external wallet. We will use
            <a target="_blank" href="https://metamask.io/">Metamask wallet</a>.
            If you didn't login in the wallet then login it now, reload page,
            come back and compile factory contract one more time. And again
            chose <b>Injected Web3</b> option. Chose Ropsten network in the
            Metamask. Select CoolSwapFactory in the CONTRACT drop-down (probably
            it's already made by default). Set an address in the
            <b>_feeToSetter</b> field. Contracts will use
            <b>feeToSetter</b> variable. This variable contains the address that
            will be able to set an address <b>feeTo</b> which will get protocol
            commission. Also <b>feeToSetter</b> can change himself to a new one.
            Now you can see something like this in the deploy tab:
            <img
              src="./img/contracts/settingsOnFactoryDeployment.png"
              alt="settings on the factory deployment in the deploy tab"
            />

            If you won't add this address and deploy just with empty field then
            protocol fee will be disabled (you can set this address in future
            after deployment). So now click on
            <b>"Deploy"</b> button and confirm a modal window from external
            wallet with transaction fee:
            <img
              src="./img/contracts/deployFactoryButton.png"
              alt="deploy option on the deploy tab"
            />
          </li>

          <li id="save-factory-address">
            After transaction has been mined you can see all details in the
            Remix terminal:
            <img
              src="./img/contracts/factoryTransactionInfoInTheConsole.png"
              alt="info about transaction where we deployed the factory"
            />

            Copy a transaction hash and go to Ropsten etherscan. Paste this hash
            in the search field and go to a new contract page. Copy his address
            and save it somewhere.
            <img
              src="./img/contracts/transactionWithCoolSwapFactory.png"
              alt="info about mined transaction on the Etherscan"
            />
            <img
              src="./img/contracts/copyFactoryAddressOnEtherscan.png"
              alt="factory contract address on the Etherscan"
            />
          </li>

          <li id="set-protocol-fee-address">
            Come back into Remix deploy tab. Open our CoolSwapFactory contract
            and paste <b>_feeTo</b> address in the <b>setFeeTob</b> method. We
            will use <code>0x7371466090234bDE67bB6c8Ba55dB705Fcec4BCB</code> address
            without funds. This address will receive protocol fee. Click on this
            method button and wait while tx will be mined. After that you can
            check this transaction on the same way as factory tx.

            <img
              src="./img/contracts/setFeeToAddress.png"
              alt="set fee to address and call contract method"
            />
          </li>

          <li id="save-init-code-hash">
            Click on the last button <b>INIT_CODE_HASH</b> that is among
            CoolSwapFactory options. Copy it (without "bytes32") and save
            somewhere:

            <img
              src="./img/contracts/saveInitCodeHash.png"
              alt="copy init code pair hash value from deployed factory contract"
            />
          </li>

          <li id="create-router-file">
            Go to <b>"File explorers"</b> tab and copy Uniswap router code into
            <b>CoolSwapRouter.sol</b>. Rename a router contract.

            <img
              src="./img/contracts/renameUniswapRouter.png"
              alt="rename router contract"
            />
          </li>

          <li id="replace-init-code-hash">
            Replace a hex value in the <b>pairFor</b> method with the
            <b>INIT_CODE_HASH</b> that we got earlier (replace it without
            <b>"0x"</b> at the beginning):

            <img
              src="./img/contracts/replaceInitCodeHashInTheRouter.png"
              alt="replace init code hash value in the router contract"
            />
          </li>

          <li id="deploy-router-contract">
            On the compiler tab enable optimization options and compile
            CoolSwapRouter file. Go to deploy tab. Pass two parameters in the
            <b>Deploy</b> method with a dot between them: factory address (that
            we just deployed) and WETH token address. Then deploy contract:

            <img
              src="./img/contracts/deploySettingsForRouterContract.png"
              alt="deploy router contract"
            />
          </li>

          <li>
            Make the same actions as after factory deployment and copy
            CoolSwapRouter address.
          </li>
        </ol>

        <blockquote id="final-contract-data">
          <p>Now we have this data:</p>
          <br />
          <a
            target="_blank"
            href="https://ropsten.etherscan.io/tx/0x05f534f7f67c291923da6930cc5d888583eb42e52e4069b7671bf34bff0d9cb3"
            >CoolSwapFactory</a
          >:
          <pre><code>0x68d3A8bc9441eF1225521C1E5EC67C6a7509Ce58</code></pre>
          <br />
          <a
            target="_blank"
            href="https://ropsten.etherscan.io/address/0xb2d64667df4c3608e0d4f3683f6e69914d185c87"
            >CoolSwapRouter</a
          >:
          <pre><code>0xB2D64667df4C3608E0d4f3683f6e69914D185C87</code></pre>
          <br />
          INIT_CODE_HASH:
          <pre><code>0x6be71632e8b409042bcda4b9b5dd96de1a924599be32bb83c12bce7d3355900e</code></pre>
        </blockquote>
      </section>

      <section>
        <h2 id="frontend">Frontend</h2>

        <blockquote>
          <p>
            Main changes in this interface template:

            <ul>
              <li>Removed all (or almost all) info about first version of Uniswap</li>
              <li>Removed UNI token info</li>
              <li>
                Removed links to Project analytics (it is not included in this description).
                And saved only necessary for swap flow pages
              </li>
              <li>
                Disabled <b>Coinbase</b>, <b>Fortmatic</b> and <b>Portis</b> options to connect external wallet.
                You can uncomment it if you have API keys
              </li>
              <li>Changed source styles just a little. Now the interface is more like Uniswap V3 then V2</li>
              <li>Some fixes, like warnings about no checksummed addresses, etc.</li>
            </ul>
          </p>
        </blockquote>

        <ol>
          <li id="interface-start-template">
            Create a new directory: CoolSwap. Copy
            <a href="#start-template-source">start template</a> code in this
            directory and nstall dependencies (do not forget about Nodejs 16).
            Fill with the a network info <code>.env</code> file. In our case it's Rinkeby testnet:

            <pre><code>REACT_APP_NETWORK_URL="https://rinkeby.infura.io/v3/3cb031735f9a46a69f2babab4fae3e0d"</code></pre>
            <pre><code>REACT_APP_CHAIN_ID="4"</code></pre>
          </li>

          <li id="what-need-to-change">
            Let's look at <code>forks</code> directory in the project root. We
            have to change <b>Uniswap sdk</b> to be able use it with our contracts. We will follow the least resistance
            and copy this builded package in our root directory. Change info directly in the sdk build and replace
            it in the <code>node_modules</code> directory after each dependency installation
            (automatically of course. NPM makes his job well). You also can do the same action as
            Uniswap and put your values in the new sdk and create own npm package. In our template we already
            have this package and npm script which will replace `node_modules` sdk with files from `forks`:

            <pre><code>"postinstall": "rm -rf ./node_modules/@uniswap/sdk; cp -r ./forks/@uniswap/sdk ./node_modules/@uniswap/sdk",</code></pre>

            All what we have to do it's replace values there with our saved info from the previous deployment.
            With our template and contracts we
            need to change only constants and <code>INIT_CODE_HASH</code>, because we use the same info for our ERC20
            contract in the Truffle deployment. Open a <code>src/constants/index.ts</code> file.
            At first copy the old <code>FACTORY_ADDRESS</code> address. Here are our constants:

            <pre><code>export const FACTORY_ADDRESS</code></pre>
            <pre><code>export const ROUTER_ADDRESS</code></pre>
            <pre><code>export const LP_TOKEN_NAME</code></pre>
            <pre><code>export const LP_TOKEN_SYMBOL</code></pre>
          </li>

          <li>
            Find all his coincidences for whole project and replace it with our new factory
            (deploy with Truffle): <code>0x6Bd5A1A63ffF10De3c6B7C667040E9AE1B47fDf2</code>.
            An example in Visual Studio Code search tab:

            <img src="./img/interface/replace-factory-address-in-interface.png" alt="" />

            For router address change it only in one place, in the same file. Our new router address:
            <code>0xA4E1f3fD10E2397f58926E215Ed331D7cDA14056</code>.

            Now go to <code>forks/@uniswap/sdk/dist/constants.d.ts</code> and copy the old init code
            hash value. Do the same steps as for the factory. Find and replace with the new value:
            <code>0xaf88dd15a55596feb9d67243c727bfd6144af12453963809bc91f0cfcf8241bc</code>.

            You probable have your token info. Well repeat the cycle, find old token name/symbol values and replace it.
            You can find your info in the Verified router contract:

            <img src="./img/interface/lp-token-info-example.png" alt="" />
          </li>

          <li id="interface-start">
            Install dependencies:

            <pre><code>npm i</code></pre>

            <blockquote>
              <p>
                Do not forget to reinstall the <code>node_modules</code> directory
                if you change something in <code>forks</code>
              </p>
            </blockquote>

            Start a server:

            <pre><code>npm start</code></pre>
          </li>

          <li>
            Now we can check that all works fine. We do not have any pools and can't make swaps.
            Connect your external wallet and go to <b>Pool</b> page. Click on a <code>Create a pair</code> button:

            <img src="./img/interface/pool-tab-without-any-pools.png" alt="" />

            We will use tokens available in the default list. In our example we're creating a new pool,
            <b>ETH</b> with <b>DAI</b>. Fill form fields. Click on a `Approve <TOKEN>` button
            and wait while transaction will be in the blockchain. After that you press a <b>Supply</b> button.
            Confirm your actions in the modal window and wait just a while:

            <img src="./img/interface/create-a-new-pool.png" alt="" />
          </li>

          <li>
            Go back to the <b>Pool</b> page and check your pool in the list:

            <img src="./img/interface/created-pool-in-list.png" alt="" />

            Let's make several swaps on the <b>Swap</b> page:

            <img src="./img/interface/swap-form-interface.png" alt="" />
          </li>

          <li id="check-protocol-fee">
            It remains for us to check accumulated protocol fee liquidity.
            Go to the <b>Pool</b> page and remove some part or all liquidity from the pool:

            <img src="./img/interface/remove-liquidity.png" alt="" />
            
            We see in our <code>remove liquidity</code> transaction the <b>feeTo</b> address,
            where were accumulated tokens sent:

            <img src="./img/interface/transaction-remove-liquidity.png" alt="" />

            Switch in the wallet to the address for collecting commissions.
            You're able to see the same pool with the amounts that has been accumulated from previous swaps:

            <img src="./img/interface/admin-liquidity-pool.png" alt="" />
          </li>
        </ol>

        <blockquote>
          <p>
            These were the minimum actions needed for the exchange to work and to collect the commission.
          </p>
        </blockquote>
      </section>

      <section>
        <h2 id="additional-changes-title">Additional changes</h2>

        <h3>Token lists</h3>
        <p>
          Here is the main file with lists sources. 
          <pre><code>constants/lists.ts</code></pre>

          All lists is available for Ethereum network.
          You can add your list address and it will be displayed here:

          <img src="./img/addition/tokenListsDisplay.png" alt="" />

          The simple way to place your list is to add it on Github for example
          and copy his address from there. When you placed a list file you need to
          press a <b>Raw</b> button and copy a url address:

          <img src="./img/addition/getTokenListUrlFromGithub.png" alt="" />

          It has to be the address of this type:
          <pre><code>https://raw.githubusercontent.com/(organization or user name)/(repo name)/main/list.json</code></pre>

          <blockquote>
            <p>
              If there is no urls, then by default is used a Uniswap package with tokens:
              <b>@uniswap/default-token-list</b>. Replace it with some other package or
              add it manually in a json file and import them from it.
            </p>
          </blockquote>
        </p>

        <h3>Language</h3>
        <div>
          How to add a new messages? Here we use a <b><code>react-i18next</code></b> package
          to translate information. Base settings file
          in the <code>src/i18.ts</code> and in the <code>src/index.ts</code> we just import it.
          After that we have to import a translation hook from a <b><code>react-i18next</code></b>
          package:
          <pre><code>import { useTranslation } from 'react-i18next';</code></pre>

          Now we need to get a <b><code>t</code></b> function from this hook somewhere
          inside your functional component:
          <pre><code>const { t } = useTranslation();</code></pre>

          And finally use this function with a translation key. For example:

          <img src="./img/addition/exampleOfTranslateUsage.png" alt="" />

          Now all what we need to do is add a <b>swap</b> key and his message value in
          translation files. They are here:

          <img src="./img/addition/localesDirectroy.png" alt="" />

          Now we already have this message. If you don't just add a key and message 
          as a value in all translation files. It will automatically detect browser
          language and show content in this language.

          <img src="./img/addition/exampleOfTranslatedMessage.png" alt="" />

          Example of reflected changes:

          <img src="./img/addition/changeTranslatedMessage.png" alt="" />
          <img src="./img/addition/changedTranslatedLinkMessage.png" alt="" />
        </div>

        <h3>User interface</h3>
        <div>
          Almost all UI color styles can be changed in this file
          <pre><code>theme/index.tsx</code></pre>

          If you want to add a new variables, don't forget add in types file:
          <pre><code>theme/styled.d.ts</code></pre>

          Logos in the Header component are used here
          <pre><code>assets/svg/*</code></pre>
        </div>

        <h3>Naming</h3>
        <div>
          <pre><code>public/index.html</code></pre>
          <pre><code>public/manifest.json</code></pre>
          <pre><code>public/locales/*</code></pre>
          <pre><code>components/vote/DelegateModal.tsx</code></pre>
          <pre><code>connectors/index.ts</code></pre>

          Change logs name if you change it in the contracts:
          <pre><code>hooks/useSwapCallback.ts</code></pre>

          <div class="group">
            Links:
            <pre><code>components/PositionCard/index.tsx</code></pre>
            <pre><code>components/swap/AdvancedSwapDetails.tsx</code></pre>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <p class="banner">
        See also: Do not want to waste your time and make mistakes?
        <br>
        Use extended version without coding skills: <a href="https://github.com/appsource/dex" target="_blank">no-code tool for creating DEX</a>
      </p>
    </footer>
  </body>
</html>
