!function(t,e,s){"use strict";s.worker={events:{load:t,beforeunload:t,resize:t,scroll:t,message:t,DOMContentLoaded:e},userScroll:!0,translator:null,initialize:function(e){let s=this.events;e=e||{},Object.keys(s).forEach((function(t){s[t].addEventListener(t,this,!1)}),this),e.href=t.location.href,navigator.serviceWorker&&navigator.serviceWorker.register(t.location.origin+"/downloader-service-worker.js").then((function(){return navigator.serviceWorker.ready})).then((function(s){if(!s||!s.active)return;let a=JSON.stringify({url:e.originalUrl,proxy:t.location.href});s.active.postMessage(a)})),this.sendMessage("inited",e)},loadHandler:function(){this.sendMessage("loaded")},handleEvent:function(t){this[t.type+"Handler"](t)},sendMessage:function(e,s){t.parent.postMessage(JSON.stringify({type:e,data:s}),"*")},beforeunloadHandler:function(){let t=this.events;this.sendMessage("unloading",{body:e.body.outerHTML,sid:s.config.sid}),this.translator&&(this.translator.halt(),this.translator=null),Object.keys(t).forEach((function(e){t[e].removeEventListener(e,this,!1)}),this)},scrollHandler:function(){let t=this.getScrollInfo();this.userScroll?this.sendMessage("scrolling",{x:t.x/(t.W-t.w),y:t.y/(t.H-t.h)}):this.userScroll=!0},resizeHandler:function(){let t=e.body,s={};t&&(s.height=Math.max(t.scrollHeight,t.offsetHeight)),this.sendMessage("resized",s)},getScrollInfo:function(){let s="BackCompat"===e.compatMode?e.body:e.documentElement;return{x:t.pageXOffset||s.scrollLeft,y:t.pageYOffset||s.scrollTop,w:s.clientWidth,h:s.clientHeight,W:s.scrollWidth,H:s.scrollHeight}},messageHandler:function(e){let a,r,n=this,o=e.data;try{o=JSON.parse(o)}catch(t){o=null}if(o)switch(o.type){case"undo":this.translator&&this.translator.undo();break;case"redo":this.translator&&this.translator.redo();break;case"halt":this.translator&&this.translator.halt();break;case"start":s.trDir=[o.data.sourceLang,o.data.targetLang].join("-"),this.translator&&(this.translator.undo(),this.translator.translate(o.data.sourceLang,o.data.targetLang));break;case"create":if(this.translator)break;r=Object.assign({},s.config,o.data),this.translator=new s.PageTranslator(r),this.translator.on("complete",(function(){n.sendMessage("complete")})).on("progress",(function(t){n.sendMessage("progress",t)})).on("error",(function(t){n.sendMessage("partialError",t)})),r.useAlign&&!r.disablePopup&&s.createPopup(this.translator,r.translatorFlag);break;case"rename":t.name=o.data;break;case"scroll":this.userScroll=!1,a=this.getScrollInfo(),t.scroll(o.data.x*(a.W-a.w),o.data.y*(a.H-a.h));break;case"highlightChunks":this.translator&&this.translator.highlightChunks()}},DOMContentLoadedHandler:function(){let t=e.body,s={};t&&(s.height=Math.max(t.scrollHeight,t.offsetHeight)),this.sendMessage("ready",s)}}}(this,this.document,this.yt=this.yt||{});